<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Padel Matcher</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* ===============================
       CLEAN LIGHT THEME (Theme 1)
       =============================== */
    :root {
      --bg: #f7f9fc;
      --panel: #ffffff;
      --ink: #1a1a1a;
      --muted: #6b7280;
      --accent: #2563eb;
      --accent2: #16a34a;
      --danger: #dc2626;
      --warn: #f59e0b;
      --line: #e5e7eb;
      --pill: #f3f4f6;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu;
      background: var(--bg);
      color: var(--ink);
    }

    header {
      padding: 14px 16px;
      border-bottom: 1px solid var(--line);
      background: white;
      display: flex;
      align-items: center;
      gap: 12px;
      position: sticky;
      top: 0;
      z-index: 5;
    }

    header h1 {
      font-size: 20px;
      margin: 0;
      font-weight: 600;
    }

    header small {
      color: var(--muted);
      font-size: 13px;
    }

    .spacer { flex: 1; }

    main {
      max-width: 1200px;
      margin: 20px auto 80px;
      padding: 0 16px;
      display: grid;
      gap: 20px;
      grid-template-columns: 380px 1fr;
    }

    section.panel {
      background: var(--panel);
      border: 1px solid var(--line);
      border-radius: 12px;
      padding: 18px;
    }

    h2 {
      margin: 0 0 12px;
      font-size: 18px;
      font-weight: 600;
    }

    .muted {
      color: var(--muted);
      font-size: 14px;
      margin-bottom: 10px;
    }

    .hr {
      height: 1px;
      background: var(--line);
      margin: 16px 0;
    }

    label {
      font-size: 14px;
      color: var(--muted);
      margin-bottom: 6px;
      display: block;
    }

    input[type=text],
    input[type=number],
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      color: #1a1a1a;
      font-size: 15px;
    }

    .row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: var(--pill);
      border: 1px solid var(--line);
      border-radius: 999px;
      font-size: 14px;
    }

    button {
      background: #e5e7eb;
      border: 1px solid #d1d5db;
      color: #1a1a1a;
      border-radius: 8px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
    }

    button.primary {
      background: var(--accent);
      border: none;
      color: white;
    }

    button.danger {
      background: var(--danger);
      border: none;
      color: white;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 8px 6px;
      border-bottom: 1px solid var(--line);
      text-align: left;
      font-size: 14px;
    }

    th {
      color: var(--muted);
      font-weight: 500;
    }

    td input[type=number] {
      width: 60px;
      text-align: center;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #d1d5db;
      background: white;
      color: #1a1a1a;
    }

    .team-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      background: var(--pill);
      border: 1px solid var(--line);
      border-radius: 999px;
      margin: 4px;
    }

    .log-item {
      padding: 4px 0;
      font-size: 14px;
    }

    .foot {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      background: white;
      border-top: 1px solid var(--line);
      padding: 10px 16px;
      display: flex;
      justify-content: center;
      color: var(--muted);
      font-size: 13px;
    }
  </style>
</head>

<body>

<header>
  <h1>Padel Matcher</h1>
  <small>Input → Courts → Time → Schedule → Score → Leaderboard</small>
  <span class="spacer"></span>
  <button id="exportBtn">Export JSON</button>
  <label class="pill" for="importFile" style="cursor:pointer">Import JSON</label>
  <input id="importFile" type="file" accept="application/json" style="display:none">
  <button class="danger" id="resetBtn">Reset</button>
</header>

<main>

  <!-- LEFT SIDE – SETUP -->
  <section class="panel">
    <h2>Setup</h2>
    <div class="muted">Add players, choose courts & timings, then generate.</div>

    <label>Players</label>
    <div id="playerList"></div>

    <div class="row">
      <input id="playerInput" type="text" placeholder="Type name, press Enter…">
      <button id="addPlayerBtn" class="primary">Add</button>
    </div>

    <div class="hr"></div>

    <label>Match Options</label>

    <div class="row">
      <label><input type="radio" name="mode" value="singles"> Singles</label>
      <label><input type="radio" name="mode" value="doubles" checked> Doubles</label>
    </div>

    <div class="row" style="margin-top:8px">
      <div style="flex:1">
        <label>Courts</label>
        <input id="courts" type="number" min="1" value="2">
      </div>
      <div style="flex:1">
        <label>Game duration (min)</label>
        <input id="gameMins" type="number" min="5" value="10">
      </div>
    </div>

    <label style="margin-top:12px">Session length (minutes)</label>
    <input id="sessionMins" type="number" min="10" value="120">

    <label style="margin-top:12px">Target total matches (optional)</label>
    <input id="targetMatches" type="number" placeholder="e.g., 24">

    <div class="hr"></div>

    <div class="row">
      <button class="primary" id="genBtn">Generate Schedule</button>
      <button id="clearBtn">Clear</button>
    </div>

    <div id="msg" class="muted" style="margin-top:10px"></div>
  </section>

  <!-- RIGHT SIDE – SCHEDULE -->
  <section class="panel">
    <h2>Schedule & Scoreboard</h2>
    <div id="scheduleEmpty" class="muted">No schedule yet.</div>
    <div id="scheduleWrap"></div>
  </section>

  <!-- BOTTOM – FULL WIDTH -->
</main>

<div style="max-width:1200px;margin:0 auto;padding:0 16px;display:grid;gap:20px;grid-template-columns:1fr 1fr">

  <!-- LEADERBOARD -->
  <section class="panel">
    <h2>Leaderboard</h2>
    <div class="muted">Ranks by Wins → PD → PF.</div>
    <div id="leaderboardWrap"></div>
  </section>

  <!-- MATCH LOG -->
  <section class="panel">
    <h2>Match Log</h2>
    <div id="logWrap" class="muted">No matches yet.</div>
  </section>

</div>

<div class="foot">All data saved locally. Export anytime.</div>

<script>
/* ========== STORAGE ========== */
const LS = "padel_v1";
let S = load() || {
  players: [],
  settings: {mode:"doubles",courts:2,gameMins:10,sessionMins:120,targetMatches:""},
  rounds:[]
};
function load(){ try{return JSON.parse(localStorage.getItem(LS));}catch(e){return null;} }
function save(){ localStorage.setItem(LS,JSON.stringify(S)); }

/* ========== ELEMENTS ========== */
const elPlayerList = document.getElementById("playerList");
const elPlayerInput = document.getElementById("playerInput");
const elAddPlayerBtn = document.getElementById("addPlayerBtn");
const elCourts = document.getElementById("courts");
const elGameMins = document.getElementById("gameMins");
const elSessionMins = document.getElementById("sessionMins");
const elTarget = document.getElementById("targetMatches");
const elScheduleEmpty = document.getElementById("scheduleEmpty");
const elScheduleWrap = document.getElementById("scheduleWrap");
const elLeaderboardWrap = document.getElementById("leaderboardWrap");
const elLogWrap = document.getElementById("logWrap");

/* ========== HELPERS ========== */
const uid = ()=>"id"+Math.random().toString(36).slice(2);
function clone(x){return JSON.parse(JSON.stringify(x));}

/* ========== RENDER PLAYERS ========== */
function renderPlayers(){
  elPlayerList.innerHTML="";
  S.players.forEach((p,i)=>{
    const div=document.createElement("div");
    div.className="team-pill";
    div.innerHTML=`${p} <button data-i="${i}" style="cursor:pointer;background:none;border:none;color:#dc2626;font-weight:bold">×</button>`;
    div.querySelector("button").onclick=()=>{S.players.splice(i,1);save();renderAll();};
    elPlayerList.appendChild(div);
  });
}

/* ========== GENERATE SCHEDULE ========== */
function settingsFromUI(){
  S.settings.mode = document.querySelector("input[name=mode]:checked").value;
  S.settings.courts = +elCourts.value;
  S.settings.gameMins = +elGameMins.value;
  S.settings.sessionMins = +elSessionMins.value;
  S.settings.targetMatches = elTarget.value;
  save();
}

function calcRounds(){
  const {courts,gameMins,sessionMins,targetMatches}=S.settings;
  const byTime = Math.floor(sessionMins/gameMins);
  if(targetMatches){
    const t = Math.ceil(targetMatches/courts);
    return Math.min(byTime,t);
  }
  return byTime;
}

function genSchedule(){
  if(S.players.length<2){ showMsg("Add players"); return; }

  settingsFromUI();
  const {mode,courts}=S.settings;
  const perTeam = mode==="singles"?1:2;
  const perCourt = perTeam*2;
  if(S.players.length<perCourt){
    showMsg("Not enough players");
    return;
  }

  const rounds = [];
  const queue = clone(S.players);
  const R = calcRounds();

  for(let r=1;r<=R;r++){
    // rotate fairness
    queue.push(queue.shift());
    const active = queue.slice(0, courts*perCourt);
    const teams=[];
    for(let i=0;i<active.length;i+=perTeam) teams.push(active.slice(i,i+perTeam));

    const matches=[];
    for(let i=0;i<teams.length;i+=2){
      if(!teams[i+1]) break;
      matches.push({
        id:uid(),
        round:r,
        court:(i/2)+1,
        teamA:teams[i],
        teamB:teams[i+1],
        scoreA:"",
        scoreB:"",
        done:false
      });
      if(matches.length===courts) break;
    }
    rounds.push(matches);
  }

  S.rounds = rounds;
  save();
  renderAll();
  showMsg("Schedule created");
}

/* ========== RENDER SCHEDULE ========== */
function renderSchedule(){
  const R = S.rounds;
  elScheduleWrap.innerHTML="";
  elScheduleEmpty.style.display = R.length? "none":"block";

  R.forEach((matches,i)=>{
    const h=document.createElement("h3");
    h.textContent="Round "+(i+1);
    elScheduleWrap.appendChild(h);

    const tbl=document.createElement("table");
    tbl.innerHTML=`<thead>
      <tr><th>Court</th><th>Team A</th><th>Team B</th><th>Score</th></tr>
    </thead>`;
    const tb=document.createElement("tbody");

    matches.forEach(m=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${m.court}</td>
        <td>${m.teamA.join(" & ")}</td>
        <td>${m.teamB.join(" & ")}</td>
        <td>
          <input type="number" data-id="${m.id}" data-s="A" min="0" value="${m.scoreA}"> :
          <input type="number" data-id="${m.id}" data-s="B" min="0" value="${m.scoreB}">
        </td>`;
      tb.appendChild(tr);
    });

    tbl.appendChild(tb);
    elScheduleWrap.appendChild(tbl);
  });

  elScheduleWrap.querySelectorAll("input").forEach(inp=>{
    inp.oninput=scoreInput;
  });
}

/* ========== SCORING ========== */
function scoreInput(e){
  const id=e.target.dataset.id;
  const side=e.target.dataset.s;

  for(const round of S.rounds){
    for(const m of round){
      if(m.id===id){
        if(side==="A") m.scoreA=e.target.value;
        else m.scoreB=e.target.value;

        const a=+m.scoreA, b=+m.scoreB;
        m.done = Number.isFinite(a)&&Number.isFinite(b)&&m.scoreA!==""&&m.scoreB!=="";
        save();
        renderLeaderboard(); renderLog();
        return;
      }
    }
  }
}

/* ========== LEADERBOARD ========== */
function computeLeaderboard(){
  const stats={};
  S.players.forEach(p=>stats[p]={P:0,W:0,L:0,PF:0,PA:0,PD:0});

  for(const round of S.rounds){
    for(const m of round){
      if(!m.done) continue;

      const a=+m.scoreA, b=+m.scoreB;
      m.teamA.forEach(p=>{stats[p].P++; stats[p].PF+=a; stats[p].PA+=b;});
      m.teamB.forEach(p=>{stats[p].P++; stats[p].PF+=b; stats[p].PA+=a;});

      if(a>b) m.teamA.forEach(p=>stats[p].W++);
      if(b>a) m.teamB.forEach(p=>stats[p].W++);
    }
  }

  Object.values(stats).forEach(s=>s.PD=s.PF-s.PA);

  return Object.entries(stats).sort((a,b)=>{
    if(b[1].W!==a[1].W) return b[1].W-a[1].W;
    if(b[1].PD!==a[1].PD) return b[1].PD-a[1].PD;
    return b[1].PF-a[1].PF;
  });
}

function renderLeaderboard(){
  const rows=computeLeaderboard();
  if(!rows.length){ elLeaderboardWrap.innerHTML=""; return; }

  const tbl=document.createElement("table");
  tbl.innerHTML=`<thead>
    <tr><th>#</th><th>Player</th><th>P</th><th>W</th><th>PF</th><th>PA</th><th>PD</th></tr>
  </thead>`;
  const tb=document.createElement("tbody");

  rows.forEach(([name,s],i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${i+1}</td>
      <td>${name}</td>
      <td>${s.P}</td>
      <td>${s.W}</td>
      <td>${s.PF}</td>
      <td>${s.PA}</td>
      <td>${s.PD}</td>`;
    tb.appendChild(tr);
  });

  tbl.appendChild(tb);
  elLeaderboardWrap.innerHTML="";
  elLeaderboardWrap.appendChild(tbl);
}

/* ========== MATCH LOG ========== */
function renderLog(){
  const out=[];
  for(const round of S.rounds){
    for(const m of round){
      if(m.done){
        out.push(`R${m.round} C${m.court}: ${m.teamA.join(" & ")} ${m.scoreA} - ${m.scoreB} ${m.teamB.join(" & ")}`);
      }
    }
  }

  if(!out.length){
    elLogWrap.textContent="No matches yet.";
    return;
  }

  elLogWrap.innerHTML = out.map(x=>`<div class="log-item">${x}</div>`).join("");
}

/* ========== MSG ========== */
function showMsg(t){
  const m=document.getElementById("msg");
  m.textContent=t;
  setTimeout(()=>m.textContent="",2000);
}

/* ========== EXPORT / IMPORT / RESET ========== */
document.getElementById("exportBtn").onclick=function(){
  const blob=new Blob([JSON.stringify(S,null,2)],{type:"application/json"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download="padel_matcher.json";
  a.click();
};

document.getElementById("importFile").onchange=async function(e){
  const f=e.target.files[0];
  if(!f) return;
  const txt=await f.text();
  try{
    const obj=JSON.parse(txt);
    S=obj; save(); renderAll();
  } catch(err){ alert("Import error"); }
};

document.getElementById("resetBtn").onclick=function(){
  if(!confirm("Reset everything?")) return;
  S={players:[],settings:{mode:"doubles",courts:2,gameMins:10,sessionMins:120,targetMatches:""},rounds:[]};
  save(); renderAll();
};

/* ========== EVENTS ========== */
elAddPlayerBtn.onclick=function(){
  const v=elPlayerInput.value.trim();
  if(!v) return;
  v.split(",").map(x=>x.trim()).filter(Boolean).forEach(p=>S.players.push(p));
  elPlayerInput.value="";
  save(); renderAll();
};

elPlayerInput.onkeydown=e=>{ if(e.key==="Enter") elAddPlayerBtn.click(); };

document.getElementById("genBtn").onclick=genSchedule;
document.getElementById("clearBtn").onclick=function(){
  S.rounds=[]; save(); renderAll();
};

/* ========== INITIAL ========== */
function renderAll(){
  renderPlayers();
  renderSchedule();
  renderLeaderboard();
  renderLog();
}

renderAll();
</script>

</body>
</html>
